<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Simple Dark Chat</title>
<style>
body { margin:0; font-family:sans-serif; background:#111; color:#eee; }
#container { display:flex; max-width:800px; height:500px; margin:30px auto; border:1px solid #333; border-radius:6px; overflow:hidden; }
#sidebar { width:180px; background:#1a1a1a; padding:10px; }
#users { list-style:none; padding:0; margin:0; }
#users li { padding:4px; font-size:0.9em; }
#chat-area { flex:1; display:flex; flex-direction:column; background:#141414; }
#chat { flex:1; overflow-y:auto; padding:10px; }
.message { margin-bottom:6px; }
.own { text-align:right; color:#8fd; }
.timestamp { font-size:0.75em; color:#aaa; margin-left:5px; }
#input { display:flex; padding:8px; background:#1c1c1c; }
#msg { flex:1; padding:6px; border:none; border-radius:4px; background:#222; color:#eee; }
button { margin-left:5px; padding:6px 10px; border:none; border-radius:4px; background:#444; color:#eee; cursor:pointer; }
button:hover { background:#666; }
</style>
</head>
<body>
<div id="container">
  <div id="sidebar">
    <h3>Online</h3>
    <ul id="users"></ul>
  </div>
  <div id="chat-area">
    <div id="chat"></div>
    <div id="input">
      <input id="msg" placeholder="Type a message...">
      <button id="send">Send</button>
    </div>
  </div>
</div>

<script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
<script>
const socket = io();
let username = localStorage.getItem("username") || prompt("Enter username:");
localStorage.setItem("username", username);
socket.emit("set_username", username);

// Send message
document.getElementById("send").onclick = () => {
    const msg = document.getElementById("msg").value;
    if(msg.trim() !== "") {
        socket.emit("message", msg);
        document.getElementById("msg").value = "";
    }
};

// Display messages
const chat = document.getElementById("chat");
socket.on("message", data => {
    const div = document.createElement("div");
    div.className = "message" + (data.username === username ? " own" : "");
    div.textContent = data.username + ": " + data.text;
    const ts = document.createElement("span");
    ts.className = "timestamp";
    ts.textContent = " " + data.timestamp;
    div.appendChild(ts);
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
});

// Load chat history
socket.on("chat_history", history => {
    history.forEach(msg => {
        const div = document.createElement("div");
        div.className = "message" + (msg.username === username ? " own" : "");
        div.textContent = msg.username + ": " + msg.text;
        const ts = document.createElement("span");
        ts.className = "timestamp";
        ts.textContent = " " + msg.timestamp;
        div.appendChild(ts);
        chat.appendChild(div);
    });
    chat.scrollTop = chat.scrollHeight;
});

// Update user list
socket.on("update_users", users => {
    const ul = document.getElementById("users");
    ul.innerHTML = "";
    users.forEach(u => {
        const li = document.createElement("li");
        li.textContent = u;
        ul.appendChild(li);
    });
});

// Username taken
socket.on("username_error", msg => {
    alert(msg);
    username = prompt("Enter another username:");
    localStorage.setItem("username", username);
    socket.emit("set_username", username);
});

// Refresh on /clear
socket.on("refresh_page", () => location.reload());
</script>
</body>
</html>
